<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>RESSA - Build JavaScript Development Tools with Rust</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "../";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="../01.overview/1.html"><strong aria-hidden="true">1.</strong> An Overview</a></li><li><a href="../02.ress/1.html"><strong aria-hidden="true">2.</strong> RESS</a></li><li><ol class="section"><li><a href="../02.ress/2.html"><strong aria-hidden="true">2.1.</strong> Building a Linter</a></li></ol></li><li><a href="../03.ressa/1.html" class="active"><strong aria-hidden="true">3.</strong> RESSA</a></li><li><ol class="section"><li><a href="../03.ressa/2.html"><strong aria-hidden="true">3.1.</strong> Building a Debug Helper</a></li></ol></li><li><a href="../04.resw/1.html"><strong aria-hidden="true">4.</strong> RESW</a></li><li><ol class="section"><li><a href="../04.resw/2.html"><strong aria-hidden="true">4.1.</strong> Building a Writer</a></li></ol></li><li><a href="../05.conclusion/1.html"><strong aria-hidden="true">5.</strong> Conclusion</a></li><li><a href="../a.appendix/overview.html"><strong aria-hidden="true">6.</strong> Appendix</a></li><li><ol class="section"><li><a href="../a.appendix/tokens.html"><strong aria-hidden="true">6.1.</strong> Tokens</a></li><li><a href="../a.appendix/ast.html"><strong aria-hidden="true">6.2.</strong> AST</a></li><li><a href="../a.appendix/string.writer.html"><strong aria-hidden="true">6.3.</strong> StringWriter</a></li><li><a href="../a.appendix/projects.html"><strong aria-hidden="true">6.4.</strong> Projects</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Build JavaScript Development Tools with Rust</h1> 

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>.presentation-only.not-presenting{display:none}.article-content.presenting{display:none}
</style>
<a class="header" href="#ressa" id="ressa"><h1>RESSA</h1></a>
<!--slides-only-->
<ul>
<li><code>impl Iterator for Parser</code></li>
<li>Converts stream of <code>Token</code>s into AST</li>
<li>Significantly more context</li>
</ul>
<!--slides-only-end-->
<!--web-only-->
<p>Before we get into how to use <code>ressa</code>, It is a good idea to briefly touch on the scope of a <strong>parser</strong> or <strong>syntax analyzer</strong>. The biggest thing to understand is that we still are not dealing with the <em>semantic</em> meaning of the program. That means we won't be able to discover things like assigning to undeclared variables or attempting to call undefined functions because we need to have access to a larger context definition. To that end, <code>ressa</code>'s true value isn't realized until it is embedded into another program that provide this information.</p>
<p>With that said <code>ressa</code> is providing that same larger contenxt for what is provided by <code>ress</code>. It achieves that by wrapping the <code>Scanner</code> in a struct called <code>Parser</code>. Essentially <code>Parser</code> provides a way to keep track of what any given set of <code>Token</code>s might mean. <code>Parser</code> also implements <code>Iterator</code> over the enum <code>ProgramPart</code>, which has 3 cases representing the 3 different top level JavaScript constructs.</p>
<ul>
<li><code>Decl</code> - a variable/function/class declaration
<ul>
<li><code>Variable</code> - A top level variable declaration e.g. <code>let x = 0;</code></li>
<li><code>Class</code> - A named class definition at the top level</li>
<li><code>Function</code> - A named function definition at the top level</li>
<li><code>Import</code> - An ES Module import statement</li>
<li><code>Export</code> - An ES Module export statement</li>
</ul>
</li>
<li><code>Directive</code> - pretty much just 'use strict'</li>
<li><code>Statement</code> - A catch all for everything else
<ul>
<li><code>Block</code> - A collection of statements wrapped in curly braces</li>
<li><code>Break</code> - A break statement will exit a loop or labeled statement early</li>
<li><code>Continue</code> - A continue statement will short circuit a loop</li>
<li><code>Debugger</code> - The literal ident <code>debugger</code></li>
<li><code>DoWhile</code> - A do loop which executes the body before testing whether to continue</li>
<li><code>Empty</code> - A single semicolon</li>
<li><code>Expr</code> - A catch-all for everything else</li>
<li><code>For</code> - A c-style for loop e.g. `for</li>
<li><code>ForIn</code> - A for loop that assigns the key of an enumerable at the top of each iteration</li>
<li><code>ForOf</code> - A for loop that assigns the value of an iterable at the top of each iteration</li>
<li><code>If</code> - A set of if/else if/else statements</li>
<li><code>Labeled</code> - A statement that has been named by an attached identifier</li>
<li><code>Return</code> - The return statement that resolves a function's value</li>
<li><code>Switch</code> - A test <code>Expression</code> a collection of <code>CaseStatements</code></li>
<li><code>Throw</code> - A statement that results in an error being thrown</li>
<li><code>Try</code> - A try/catch/finally block</li>
<li><code>Var</code> - A non-top level variable declaration</li>
<li><code>While</code> - A loop which continues based on a test <code>Expresssion</code></li>
<li><code>With</code> - An antiquated statement that changes the order of identifier resolution</li>
</ul>
</li>
</ul>
<p><code>Statement</code> being the real work-horse of the group, while a top level function definition would be a <code>Decl</code>, a non-top level function definition would be a <code>Statement</code>. Both <code>Decl</code> and <code>Statement</code> themselves are enums representing the different possible variations. Looking further into the <code>Statement</code> variants, you may notice there is another <em>catch-all</em> in the <code>Expr</code> variant. A sub class of <code>Statement</code> is the <code>Expression</code> enum which defines an even more granular set of program parts.</p>
<ul>
<li><code>Expression</code>
<ul>
<li><code>Assignment</code> - A single assignment in a variable declaration, this is required because a variable declaration can have multiple assignments</li>
<li><code>Array</code> - An array literal</li>
<li><code>ArrowFunction</code> - An arrow function expression</li>
<li><code>Await</code> - Any expression preceded by the <code>await</code> keyword</li>
<li><code>Call</code> - Calling a function or method</li>
<li><code>Class</code> - A class expression is a class definition with an optional identifier that is assigned to a variable</li>
<li><code>Conditional</code> - Also known as the &quot;ternary&quot; operator e.g.<code>let x = test ? consequent : alternate</code></li>
<li><code>Function</code> - A function expression is a function definition with an optional identifier that is either self executing, assigned to a variable or a <code>Call</code> argument</li>
<li><code>Ident</code> - The identifier of a variable, class, import, export or function</li>
<li><code>Literal</code> - A &quot;primitive&quot; literal</li>
<li><code>Logical</code> - Two expressions separated by <code>&amp;&amp;</code> or <code>||</code></li>
<li><code>Member</code> - Accessing a sub property on something. e.g. <code>[0,1,2][1]</code> or <code>console.log</code></li>
<li><code>MetaProperty</code> - Currently the only <code>MetaProperty</code> is in a function body you can check <code>new.target</code> to see if something was called with the <code>new</code> keyword</li>
<li><code>New</code> - A <code>Call</code> expression preceded by the <code>new</code> keyword</li>
<li><code>Object</code> - An object literal</li>
<li><code>Sequence</code> - Any sequence of expressions separated by commas</li>
<li><code>Spread</code> - the <code>...</code> operator followed by an expression</li>
<li><code>SuperExpression</code> - The <code>super</code> pseudo-keyword</li>
<li><code>TaggedTemplate</code> - An identifier followed by a template literal</li>
<li><code>ThisExpression</code> - The <code>this</code> pseudo-keyword</li>
<li><code>Unary</code> - An operation (that is not an update) that requires on expression as an argument</li>
<li><code>Update</code> - An operation that uses the <code>++</code> or <code>--</code> operator</li>
<li><code>Yield</code> - the <code>yield</code> contextual keyword followed by an optional expression for use in generator function</li>
</ul>
</li>
</ul>
<p>Most of the <code>Expression</code>, <code>Statement</code>, and <code>Decl</code> variants have associated values, to see more information about them check out the <a href="https://docs.rs/ressa">documentation</a>. There should be an example and description provided for each of the possible combinations.</p>
<p>With that long winded explanation of the <em>basic</em> structure we are working with let's take a look at how we would use the <code>Parser</code> and <code>ProgramPart</code>.</p>
<!--web-only-end-->
<pre><pre class="playpen"><code class="language-rust">use ressa::*;

static JS: &amp;str = &quot;
function Thing(stuff) {
    this.stuff = stuff;
}
class Stuff {
    constructor(thing) {
        this.thing = thing;
    }
}
&quot;;

fn main() {
    let parser = Parser::new(JS).expect(&quot;Failed to create parser&quot;);
    for part in parser {
        let part = part.expect(&quot;Failed to parse part&quot;);
        println!(&quot;{:?}&quot;, part);
    }
}
</code></pre></pre>
<!--web-only-->
<p>If we were to run the above we would get the following output.</p>
<!--web-only-end-->
<pre><code class="language-ron">Script([
    Decl(
        Function(
            Function {
                id: Some(
                    &quot;Thing&quot;
                ),
                params: [
                    Pattern(
                        Identifier(
                            &quot;stuff&quot;
                        )
                    )
                ],
                body: [
                    Statement(
                        Expr(
                            Assignment(
                                AssignmentExpression {
                                    operator: Equal,
                                    left: Expr(
                                        Member(
                                            MemberExpression {
                                                object: ThisExpression,
                                                property: Ident(
                                                    &quot;stuff&quot;
                                                ),
                                                computed: false
                                            }
                                        )
                                    ),
                                    right: Ident(
                                        &quot;stuff&quot;
                                    )
                                }
                            )
                        )
                    )
                ],
                generator: false,
                is_async: false
            }
        )
    )
])
</code></pre>
<!--web-only-->
<p>If we walk through the output, we start by seeing that the</p>
<ol>
<li>This program consists of a single part which is a  <code>ProgramPart::Decl</code></li>
<li>Inside of that is a <code>Declaration::Function</code></li>
<li>Inside of that is a <code>Function</code>
<ol>
<li>Has an <code>id</code> of an optional <code>Identifier</code> with the value of <code>Some(&quot;Thing&quot;)</code></li>
<li>It has a one item vec of <code>Pattern</code>s in <code>params</code>
<ol>
<li>Which is a <code>Pattern::Identifier</code></li>
<li>Inside of that is an <code>Identifier</code> with the value of &quot;stuff&quot;</li>
</ol>
</li>
<li>It has a body that is a one item vec of <code>ProgramPart</code>s
<ol>
<li>The item is a <code>ProgramPart::Statement</code></li>
<li>Which is a <code>Statement::Expr</code></li>
<li>Inside of that is an <code>Expression::Assignment</code></li>
<li>Inside of that is an <code>AssignmentExpression</code>
<ol>
<li>Which has an <code>operator</code> of <code>Equal</code></li>
<li>The <code>left</code> hand side is an <code>Expression::Member</code>
<ol>
<li>The <code>object</code> being <code>Expression::This</code></li>
<li>The <code>property</code> of <code>Expression::Ident</code> with the value of &quot;stuff&quot;</li>
</ol>
</li>
<li>The <code>right</code> hand side is an <code>Expression::Ident</code> with the value of &quot;stuff&quot;</li>
<li><code>computed</code> is false</li>
</ol>
</li>
</ol>
</li>
<li>It is not a <code>generator</code></li>
<li>It is not <code>is_async</code></li>
</ol>
</li>
</ol>
<p>Phew! That is quite a lot of information! A big part of why we need to be that verbose is because of the &quot;you can do anything&quot; nature of JavaScript. Let's use the <code>MemberExpression</code> and an example, below are a collection of ways to write a <code>MemberExpression</code> in JavaScript.</p>
<pre><code class="language-js">console.log;
console['log'];
const logVar = 'log';
console[logVar];
console[['l','o','g'].join('')];
class Log {
    toString() {
        return 'log';
    }
}
const logToString = new Log();
console[logToString];
function logFunc() {
    return 'log';
}
console[logFunc()];
function getConsole() {
    return console
}
getConsole()[logFunc()];
getConsole().log;
</code></pre>
<p>And with the way JavaScript has evolved this probably isn't an exhaustive list of ways to construct a <code>MemberExpression</code>. With the level of information provided we have enough to truly understand the syntactic meaning of the text. This will enable us to build more powerful tools to analyze and/or manipulate the any given JavaScript program. With the pervasivness of <a href="https://en.wikipedia.org/wiki/Debugging#Techniques">print debugging</a>, wouldn't it be nice if we had a tool that would automatically insert a <code>console.log</code> at the top of every function and method in a program that would print the name of that function and also each of the arguments? Let's take a look at what that might look like.</p>
<!--web-only-end-->
<script>var PresentationMode;!function(e){e[e.Slides=0]="Slides",e[e.Web=1]="Web"}(PresentationMode||(PresentationMode={}));var PresentationModeHider=function(){function e(){var t=this;(this.queryKey="presentation_mode",this.webClass="article-content",this.preClass="presentation-only",this.mode=this.getMode(),this.setMode(),this.assignClassesViaComments(),this.mode!==PresentationMode.Slides||""!==location.pathname&&"/"!==location.pathname)||document.querySelector(".sidebar > .chapter").firstChild.firstChild.click();window.addEventListener("keyup",function(e){e.altKey&&("p"!=e.key&&"P"!=e.key&&"KeyP"!=e.code||t.toggle())})}return e.prototype.assignClassesViaComments=function(){for(var e,t=document.createNodeIterator(document.body,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,null),n=this.mode===PresentationMode.Web?"not-presenting":"presenting",o=null;e=t.nextNode();)if(8===e.nodeType){var s=e.nodeValue.trim();o="web-only"===s?this.webClass:"slides-only"===s?this.preClass:null}else 1===e.nodeType&&null!==o&&e.classList.add(o,n)},e.prototype.getMode=function(){var t=localStorage.getItem(this.queryKey);if(null===t)return PresentationMode.Web;try{var e=parseInt(t);return 1<e||e<0?(console.error("presentation_mode was out of range",e),PresentationMode.Web):e}catch(e){return console.error("presentation_mode present in localStorage but value is not an integer",t,e),PresentationMode.Web}},e.prototype.setMode=function(){localStorage.setItem(this.queryKey,this.mode.toString())},e.prototype.updatePage=function(){this.updateElements(document.querySelectorAll(".presentation-only")),this.updateElements(document.querySelectorAll(".article-content"))},e.prototype.updateElements=function(e){for(var t=0;t<e.length;t++){var n=e[t];this.mode===PresentationMode.Slides?n.classList.replace("not-presenting","presenting"):n.classList.replace("presenting","not-presenting")}},e.prototype.toggle=function(){switch(this.mode){case PresentationMode.Slides:this.mode=PresentationMode.Web;break;case PresentationMode.Web:this.mode=PresentationMode.Slides}this.setMode(),this.updatePage()},e}(),___presentationModeHider=new PresentationModeHider;</script>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../02.ress/2.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../03.ressa/2.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../02.ress/2.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../03.ressa/2.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
